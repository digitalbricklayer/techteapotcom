# things that the GNU standards document suggests all makefiles
# should have.
SHELL = /bin/sh
.SUFFIXES:
.SUFFIXES: .c .o .pl .pm .pod .html .man

# variables we got from configure
# (you can mess with these, if you want)

CC = @CC@
AR = ar
CFLAGS_EXTRA = @CFLAGS_EXTRA@
CFLAGS = @CFLAGS@
CFLAGS_ALL = $(CFLAGS) $(CFLAGS_EXTRA) -I../cgilib-0.4 -I.. -I../gd1.3 -I../libpng-1.0.3 -I../zlib-1.1.3 -DHAVE_CONFIG_H
LDFLAGS = @LDFLAGS@
LIBS = -L. -lrrd -L../cgilib-0.4 -lrrd_cgi -L../gd1.3 -lrrd_gd  -L../libpng-1.0.3 -lrrd_png -L../zlib-1.1.3 -lrrd_z @LIBS@ 
LIBS_DEPEND = ../libpng-1.0.3/librrd_png.a ../zlib-1.1.3/librrd_z.a ../gd1.3/librrd_gd.a ../cgilib-0.4/librrd_cgi.a

###
### Things you might NOT want to play with ... 
###

HEADERS = rrd_tool.h rrd_format.h getopt.h parsetime.h

SRCLIB = rrd_fetch.c rrd_create.c rrd_dump.c rrd_restore.c rrd_graph.c rrd_tune.c \
	rrd_open.c rrd_diff.c rrd_last.c rrd_update.c rrd_format.c rrd_error.c \
	getopt.c getopt1.c parsetime.c rrd_resize.c gifsize.c pngsize.c gdpng.c

SRC = $(SRCLIB) rrd_tool.c rrd_cgi.c

OBJ = $(SRC:.c=.o)
OBJLIB = $(SRCLIB:.c=.o)

all: rrdtool rrdcgi librrd.a

rrdtool: librrd.a rrd_tool.o $(LIBS_DEPEND)
	$(CC) -o rrdtool rrd_tool.o $(LDFLAGS) $(LIBS)

rrdcgi: librrd.a rrd_cgi.o $(LIBS_DEPEND)
	$(CC) -o rrdcgi rrd_cgi.o $(LDFLAGS) $(LIBS)

librrd.a: $(OBJLIB)
	$(AR) rc librrd.a $(OBJLIB)
	@RANLIB@ librrd.a

rrdtool.pure: $(OBJ) $(LIBS_DEPEND)
	purify $(CC) -o rrdtool.pure $(OBJ) $(LDFLAGS) $(LIBS)

clean:  
	-rm *.o *.a

realclean: clean
	-rm rrdtool rrdtool.pure

.c.o:	$(HEADERS)
	$(CC) $(CFLAGS_ALL) -c $<
